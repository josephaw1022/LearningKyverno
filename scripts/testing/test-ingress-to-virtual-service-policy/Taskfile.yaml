version: "3"

tasks:
  policy-test-setup:
    desc: "Run the policy test setup: Creates an Argo app that installs Keycloak with an ingress"
    cmds:
      - helm upgrade --install --wait keycloak-app . -n keycloak --create-namespace
    aliases:
      - deploy-keycloak

  policy-test-describe:
    desc: "Describe the policy test setup"
    cmds:
      - kubectl describe app keycloak-app -n argocd
      - kubectl get all -n keycloak

  policy-test-run:
    desc: "Run the policy test helm tests"
    cmds:
      - helm test keycloak-app
    aliases:
      - run-tests
      - tests
      - test

  policy-test-teardown:
    desc: "Run the policy test teardown"
    cmds:
      - helm uninstall keycloak-app --wait -n keycloak
      - kubectl delete ns keycloak
    aliases:
      - test-teardown
